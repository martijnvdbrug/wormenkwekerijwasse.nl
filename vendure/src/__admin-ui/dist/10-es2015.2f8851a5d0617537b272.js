(window.webpackJsonp=window.webpackJsonp||[]).push([[10],{AoMm:function(t,e,i){"use strict";i.r(e),i.d(e,"SimpleCmsModule",(function(){return R}));var c=i("sEIs"),n=i("ixhn"),o=i("H5qd"),r=i.n(o);const s=r.a`
    fragment SimpleContentBlockFragment on SimpleContentBlock {
        id
        createdAt
        updatedAt
        author
        title
        slug
        featuredImage
        description
        body
    }`,a=r.a`
    mutation createSimpleContentBlock($input: SimpleContentBlockInput!) {
        createSimpleContentBlock(input: $input) {
            ...SimpleContentBlockFragment
        }
    }
    ${s}
`,l=r.a`
    query simpleContentBlock($id: ID!) {
        simpleContentBlock(id: $id) {
            ...SimpleContentBlockFragment
        }
    }
    ${s}
`,d=r.a`
    query simpleContentBlocks {
        simpleContentBlocks {
            ...SimpleContentBlockFragment
        }
    }
    ${s}
`,u=r.a`
    mutation updateSimpleContentBlock($id: ID!, $input: SimpleContentBlockInput!) {
        updateSimpleContentBlock(id: $id, input: $input) {
            ...SimpleContentBlockFragment
        }
    }
    ${s}
`,p=r.a`
    mutation deleteSimpleContentBlock($id: ID!) {
        deleteSimpleContentBlock(id: $id)
    }
`;var h=i("EM62"),f=i("2kYt"),m=i("Kej3");const b=function(){return["./create"]};function v(t,e){1&t&&(h.ic(0,"a",4),h.dc(1,"clr-icon",5),h.hc()),2&t&&h.yc("routerLink",h.Bc(1,b))}function g(t,e){if(1&t){const t=h.jc();h.ic(0,"tr"),h.ic(1,"td",6),h.ic(2,"a"),h.Wc(3),h.hc(),h.hc(),h.ic(4,"td"),h.ic(5,"a",7),h.pc("click",(function(){h.Lc(t);const i=e.$implicit;return h.rc().delete(i.id)})),h.dc(6,"clr-icon",8),h.hc(),h.hc(),h.hc()}if(2&t){const t=e.$implicit;h.Rb(1),h.yc("routerLink",t.id),h.Rb(2),h.Xc(t.title)}}class k{constructor(t,e){this.baseDataService=t,this.notificationService=e,this.blocks=[]}ngOnInit(){this.baseDataService.query(d).single$.subscribe(t=>this.blocks=t.simpleContentBlocks,t=>this.notificationService.error("Failed to get contentBlocks!"))}delete(t){window.confirm("Are you sure?")&&this.baseDataService.mutate(p,{id:t}).subscribe(t=>{this.notificationService.success("Deleted"),this.ngOnInit()},t=>this.notificationService.error("Failed to delete content!"))}}k.\u0275fac=function(t){return new(t||k)(h.cc(n.v),h.cc(n.Fb))},k.\u0275cmp=h.Wb({type:k,selectors:[["content-block-list"]],decls:9,vars:2,consts:[["locationId","product-list"],["class","btn btn-primary",3,"routerLink",4,"vdrIfPermissions"],[2,"width","80%"],[4,"ngFor","ngForOf"],[1,"btn","btn-primary",3,"routerLink"],["shape","plus"],[3,"routerLink"],[1,"btn","btn-sml",3,"click"],["shape","trash",1,"is-danger"]],template:function(t,e){1&t&&(h.ic(0,"vdr-ab-right"),h.dc(1,"vdr-action-bar-items",0),h.Uc(2,v,2,2,"a",1),h.hc(),h.dc(3,"br"),h.dc(4,"br"),h.dc(5,"br"),h.dc(6,"br"),h.ic(7,"table",2),h.Uc(8,g,7,2,"tr",3),h.hc()),2&t&&(h.Rb(2),h.yc("vdrIfPermissions","CreateCatalog"),h.Rb(6),h.yc("ngForOf",e.blocks))},directives:[n.f,n.d,n.sb,f.o,c.h,m.o,c.f],encapsulation:2});var C=i("nIj0"),S=i("s2Ay");function y(t,e){if(1&t){const t=h.jc();h.ic(0,"button",19),h.pc("click",(function(){h.Lc(t);return h.rc().cancel()})),h.Wc(1," Cancel "),h.hc()}}function F(t,e){if(1&t){const t=h.jc();h.ic(0,"img",20),h.pc("click",(function(){h.Lc(t);return h.rc().selectFeaturedAsset()})),h.sc(1,"assetPreview"),h.hc()}if(2&t){const t=h.rc();h.yc("src",h.uc(1,1,t.featuredAsset,"small"),h.Nc)}}function B(t,e){if(1&t&&(h.ic(0,"p"),h.Wc(1),h.hc()),2&t){const t=h.rc();h.Rb(1),h.Xc(t.featuredAssetUrl)}}function I(t,e){if(1&t){const t=h.jc();h.ic(0,"div",21),h.pc("click",(function(){h.Lc(t);return h.rc().selectFeaturedAsset()})),h.dc(1,"clr-icon",22),h.ic(2,"div"),h.Wc(3),h.sc(4,"translate"),h.hc(),h.hc()}2&t&&(h.Rb(3),h.Xc(h.tc(4,1,"catalog.no-featured-asset")))}function w(t,e){if(1&t){const t=h.jc();h.ic(0,"div",23),h.ic(1,"button",24),h.pc("click",(function(){h.Lc(t);return h.rc().selectFeaturedAsset()})),h.dc(2,"clr-icon",25),h.Wc(3),h.sc(4,"translate"),h.hc(),h.hc()}2&t&&(h.Rb(3),h.Yc(" ",h.tc(4,1,"asset.add-asset")," "))}class A{constructor(t,e,i,c,n,o){this.formBuilder=t,this.router=e,this.modalService=i,this.baseDataService=c,this.notificationService=n,this.route=o,this.descriptionWordCount=0,this.detailForm=this.formBuilder.group({title:["",C.C.required],slug:"",description:"",body:["",C.C.required]})}ngOnInit(){this.route.params.subscribe(t=>{this.id=t.id,this.id&&this.baseDataService.query(l,{id:this.id}).single$.subscribe(t=>{const e=t.simpleContentBlock;this.detailForm.patchValue({title:e.title,slug:e.slug,description:e.description,body:e.body}),this.featuredAssetUrl=e.featuredImage},t=>this.notificationService.error(`Failed to get block ${this.id}`))})}updateSlug(t){if(!t)return this.detailForm.setValue({slug:""});this.detailForm.patchValue({slug:t.replace(/\s+/g,"-").toLowerCase()})}save(){var t;const e=this.detailForm.getRawValue();console.log("ID",this.id);const i={featuredImage:null===(t=this.featuredAsset)||void 0===t?void 0:t.preview,title:e.title,slug:e.slug,description:e.description,body:e.body};this.id?this.baseDataService.mutate(u,{id:this.id,input:i}).subscribe(t=>{var e,i;this.id=null===(i=null===(e=t)||void 0===e?void 0:e.updateSimpleContentBlock)||void 0===i?void 0:i.id,this.notificationService.success("Saved")},t=>this.notificationService.error("Failed to update content!")):this.baseDataService.mutate(a,{input:i}).subscribe(t=>{var e,i;this.id=null===(i=null===(e=t)||void 0===e?void 0:e.createSimpleContentBlock)||void 0===i?void 0:i.id,this.notificationService.success("Saved")},t=>this.notificationService.error("Failed to update content!"))}cancel(){window.confirm("Are you sure?")&&this.router.navigate(["../extensions/simple-cms"])}countWords(){var t;this.descriptionWordCount=(null===(t=this.detailForm.getRawValue().description)||void 0===t?void 0:t.length)||0}selectFeaturedAsset(){this.modalService.fromComponent(n.o,{size:"xl"}).subscribe(t=>{t&&t.length&&(this.featuredAsset=t[0])})}}A.\u0275fac=function(t){return new(t||A)(h.cc(C.e),h.cc(c.e),h.cc(n.Eb),h.cc(n.v),h.cc(n.Fb),h.cc(c.a))},A.\u0275cmp=h.Wb({type:A,selectors:[["content-block-detail"]],decls:22,vars:8,consts:[["class","btn btn-secondary",3,"click",4,"vdrIfPermissions"],[1,"btn","btn-primary",3,"disabled","click"],[1,"form",3,"formGroup","keydown.enter"],["label","Featured asset","for","featuredAsset"],[1,"card"],[1,"card-img"],[1,"featured-asset"],[3,"src","click",4,"ngIf"],[4,"ngIf"],["class","placeholder",3,"click",4,"ngIf"],[1,"card-block"],["class","card-footer",4,"vdrIfPermissions"],["label","Title","for","title"],["id","title","type","text","formControlName","title",3,"input"],["label","Slug","for","slug"],["id","slug","type","text","formControlName","slug"],["for","description",3,"label"],["id","description","formControlName","description",2,"width","100%",3,"input"],["id","contentBlockRte","formControlName","body","label","Content body"],[1,"btn","btn-secondary",3,"click"],[3,"src","click"],[1,"placeholder",3,"click"],["shape","image","size","128"],[1,"card-footer"],[1,"btn",3,"click"],["shape","attachment"]],template:function(t,e){1&t&&(h.ic(0,"vdr-ab-right"),h.Uc(1,y,2,0,"button",0),h.ic(2,"button",1),h.pc("click",(function(){return e.save()})),h.Wc(3," Save "),h.hc(),h.hc(),h.ic(4,"form",2),h.pc("keydown.enter",(function(t){return t.preventDefault()})),h.ic(5,"vdr-form-field",3),h.ic(6,"div",4),h.ic(7,"div",5),h.ic(8,"div",6),h.Uc(9,F,2,4,"img",7),h.Uc(10,B,2,1,"p",8),h.Uc(11,I,5,3,"div",9),h.hc(),h.hc(),h.ic(12,"div",10),h.ec(13),h.hc(),h.Uc(14,w,5,3,"div",11),h.hc(),h.hc(),h.ic(15,"vdr-form-field",12),h.ic(16,"input",13),h.pc("input",(function(t){return e.updateSlug(t.target.value)})),h.hc(),h.hc(),h.ic(17,"vdr-form-field",14),h.dc(18,"input",15),h.hc(),h.ic(19,"vdr-form-field",16),h.ic(20,"textarea",17),h.pc("input",(function(){return e.countWords()})),h.hc(),h.hc(),h.dc(21,"vdr-rich-text-editor",18),h.hc()),2&t&&(h.Rb(1),h.yc("vdrIfPermissions","UpdateCatalog"),h.Rb(1),h.yc("disabled",e.detailForm.invalid||e.detailForm.pristine),h.Rb(2),h.yc("formGroup",e.detailForm),h.Rb(5),h.yc("ngIf",e.featuredAsset),h.Rb(1),h.yc("ngIf",e.featuredAssetUrl&&!e.featuredAsset),h.Rb(1),h.yc("ngIf",!e.featuredAsset),h.Rb(3),h.yc("vdrIfPermissions","UpdateCatalog"),h.Rb(5),h.Ac("label","SEO description (",e.descriptionWordCount,") "))},directives:[n.f,n.sb,C.E,C.q,C.j,n.fb,f.p,n.gb,C.b,C.p,C.h,n.Lb,m.o],pipes:[n.r,S.d],styles:["[_nghost-%COMP%]     #contentBlockRte>div>div>div.ProseMirror.vdr-prosemirror{height:600px;resize:vertical}.placeholder[_ngcontent-%COMP%]{text-align:center;color:var(--color-grey-300)}.featured-asset[_ngcontent-%COMP%]{text-align:center;background:var(--color-component-bg-200);padding:6px;cursor:pointer}.featured-asset.compact[_ngcontent-%COMP%]{width:100%;min-height:40px;position:relative;padding:6px}.featured-asset[_ngcontent-%COMP%]   .compact-select[_ngcontent-%COMP%]{position:absolute;bottom:6px;right:6px;margin:0}"]});class R{}R.\u0275mod=h.ac({type:R}),R.\u0275inj=h.Zb({factory:function(t){return new(t||R)},imports:[[n.Ob,c.i.forChild([{path:"",pathMatch:"full",component:k,data:{breadcrumb:"Content"}},{path:"create",pathMatch:"full",component:A,data:{breadcrumb:"Content"}},{path:":id",pathMatch:"full",component:A,data:{breadcrumb:"Content"}}])]]})}}]);
//# sourceMappingURL=10-es2015.2f8851a5d0617537b272.js.map