!function(){function t(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function e(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function n(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}function i(){var t=u(["\n    mutation deleteSimpleContentBlock($id: ID!) {\n        deleteSimpleContentBlock(id: $id)\n    }\n"]);return i=function(){return t},t}function c(){var t=u(["\n    mutation updateSimpleContentBlock($id: ID!, $input: SimpleContentBlockInput!) {\n        updateSimpleContentBlock(id: $id, input: $input) {\n            ...SimpleContentBlockFragment\n        }\n    }\n    ","\n"]);return c=function(){return t},t}function r(){var t=u(["\n    query simpleContentBlocks {\n        simpleContentBlocks {\n            ...SimpleContentBlockFragment\n        }\n    }\n    ","\n"]);return r=function(){return t},t}function o(){var t=u(["\n    query simpleContentBlock($id: ID!) {\n        simpleContentBlock(id: $id) {\n            ...SimpleContentBlockFragment\n        }\n    }\n    ","\n"]);return o=function(){return t},t}function a(){var t=u(["\n    mutation createSimpleContentBlock($input: SimpleContentBlockInput!) {\n        createSimpleContentBlock(input: $input) {\n            ...SimpleContentBlockFragment\n        }\n    }\n    ","\n"]);return a=function(){return t},t}function s(){var t=u(["\n    fragment SimpleContentBlockFragment on SimpleContentBlock {\n        id\n        createdAt\n        updatedAt\n        author\n        title\n        slug\n        featuredImage\n        description\n        body\n    }"]);return s=function(){return t},t}function u(t,e){return e||(e=t.slice(0)),Object.freeze(Object.defineProperties(t,{raw:{value:Object.freeze(e)}}))}(window.webpackJsonp=window.webpackJsonp||[]).push([[9],{AoMm:function(e,u,l){"use strict";l.r(u),l.d(u,"SimpleCmsModule",(function(){return W}));var d=l("sEIs"),f=l("ixhn"),p=l("H5qd"),v=l.n(p),b=v.a(s()),m=v.a(a(),b),h=v.a(o(),b),g=v.a(r(),b),k=v.a(c(),b),y=v.a(i()),C=l("EM62"),S=l("2kYt"),F=l("Kej3"),B=function(){return["./create"]};function w(t,e){1&t&&(C.ic(0,"a",4),C.dc(1,"clr-icon",5),C.hc()),2&t&&C.yc("routerLink",C.Bc(1,B))}function I(t,e){if(1&t){var n=C.jc();C.ic(0,"tr"),C.ic(1,"td",6),C.ic(2,"a"),C.Wc(3),C.hc(),C.hc(),C.ic(4,"td"),C.ic(5,"a",7),C.pc("click",(function(){C.Lc(n);var t=e.$implicit;return C.rc().delete(t.id)})),C.dc(6,"clr-icon",8),C.hc(),C.hc(),C.hc()}if(2&t){var i=e.$implicit;C.Rb(1),C.yc("routerLink",i.id),C.Rb(2),C.Xc(i.title)}}var A=function(){function e(n,i){t(this,e),this.baseDataService=n,this.notificationService=i,this.blocks=[]}return n(e,[{key:"ngOnInit",value:function(){var t=this;this.baseDataService.query(g).single$.subscribe((function(e){return t.blocks=e.simpleContentBlocks}),(function(e){return t.notificationService.error("Failed to get contentBlocks!")}))}},{key:"delete",value:function(t){var e=this;window.confirm("Are you sure?")&&this.baseDataService.mutate(y,{id:t}).subscribe((function(t){e.notificationService.success("Deleted"),e.ngOnInit()}),(function(t){return e.notificationService.error("Failed to delete content!")}))}}]),e}();A.\u0275fac=function(t){return new(t||A)(C.cc(f.v),C.cc(f.Fb))},A.\u0275cmp=C.Wb({type:A,selectors:[["content-block-list"]],decls:9,vars:2,consts:[["locationId","product-list"],["class","btn btn-primary",3,"routerLink",4,"vdrIfPermissions"],[2,"width","80%"],[4,"ngFor","ngForOf"],[1,"btn","btn-primary",3,"routerLink"],["shape","plus"],[3,"routerLink"],[1,"btn","btn-sml",3,"click"],["shape","trash",1,"is-danger"]],template:function(t,e){1&t&&(C.ic(0,"vdr-ab-right"),C.dc(1,"vdr-action-bar-items",0),C.Uc(2,w,2,2,"a",1),C.hc(),C.dc(3,"br"),C.dc(4,"br"),C.dc(5,"br"),C.dc(6,"br"),C.ic(7,"table",2),C.Uc(8,I,7,2,"tr",3),C.hc()),2&t&&(C.Rb(2),C.yc("vdrIfPermissions","CreateCatalog"),C.Rb(6),C.yc("ngForOf",e.blocks))},directives:[f.f,f.d,f.sb,S.o,d.h,F.o,d.f],encapsulation:2});var R=l("nIj0"),O=l("s2Ay");function P(t,e){if(1&t){var n=C.jc();C.ic(0,"button",19),C.pc("click",(function(){return C.Lc(n),C.rc().cancel()})),C.Wc(1," Cancel "),C.hc()}}function x(t,e){if(1&t){var n=C.jc();C.ic(0,"img",20),C.pc("click",(function(){return C.Lc(n),C.rc().selectFeaturedAsset()})),C.sc(1,"assetPreview"),C.hc()}if(2&t){var i=C.rc();C.yc("src",C.uc(1,1,i.featuredAsset,"small"),C.Nc)}}function $(t,e){if(1&t&&(C.ic(0,"p"),C.Wc(1),C.hc()),2&t){var n=C.rc();C.Rb(1),C.Xc(n.featuredAssetUrl)}}function j(t,e){if(1&t){var n=C.jc();C.ic(0,"div",21),C.pc("click",(function(){return C.Lc(n),C.rc().selectFeaturedAsset()})),C.dc(1,"clr-icon",22),C.ic(2,"div"),C.Wc(3),C.sc(4,"translate"),C.hc(),C.hc()}2&t&&(C.Rb(3),C.Xc(C.tc(4,1,"catalog.no-featured-asset")))}function D(t,e){if(1&t){var n=C.jc();C.ic(0,"div",23),C.ic(1,"button",24),C.pc("click",(function(){return C.Lc(n),C.rc().selectFeaturedAsset()})),C.dc(2,"clr-icon",25),C.Wc(3),C.sc(4,"translate"),C.hc(),C.hc()}2&t&&(C.Rb(3),C.Yc(" ",C.tc(4,1,"asset.add-asset")," "))}var M=function(){function e(n,i,c,r,o,a){t(this,e),this.formBuilder=n,this.router=i,this.modalService=c,this.baseDataService=r,this.notificationService=o,this.route=a,this.descriptionWordCount=0,this.detailForm=this.formBuilder.group({title:["",R.C.required],slug:"",description:"",body:["",R.C.required]})}return n(e,[{key:"ngOnInit",value:function(){var t=this;this.route.params.subscribe((function(e){t.id=e.id,t.id&&t.baseDataService.query(h,{id:t.id}).single$.subscribe((function(e){var n=e.simpleContentBlock;t.detailForm.patchValue({title:n.title,slug:n.slug,description:n.description,body:n.body}),t.featuredAssetUrl=n.featuredImage}),(function(e){return t.notificationService.error("Failed to get block ".concat(t.id))}))}))}},{key:"updateSlug",value:function(t){if(!t)return this.detailForm.setValue({slug:""});this.detailForm.patchValue({slug:t.replace(/\s+/g,"-").toLowerCase()})}},{key:"save",value:function(){var t,e=this,n=this.detailForm.getRawValue();console.log("ID",this.id);var i={featuredImage:null===(t=this.featuredAsset)||void 0===t?void 0:t.preview,title:n.title,slug:n.slug,description:n.description,body:n.body};this.id?this.baseDataService.mutate(k,{id:this.id,input:i}).subscribe((function(t){var n,i;e.id=null===(i=null===(n=t)||void 0===n?void 0:n.createSimpleContentBlock)||void 0===i?void 0:i.id,e.notificationService.success("Saved")}),(function(t){return e.notificationService.error("Failed to update content!")})):this.baseDataService.mutate(m,{input:i}).subscribe((function(t){var n,i;e.id=null===(i=null===(n=t)||void 0===n?void 0:n.createSimpleContentBlock)||void 0===i?void 0:i.id,e.notificationService.success("Saved")}),(function(t){return e.notificationService.error("Failed to update content!")}))}},{key:"cancel",value:function(){window.confirm("Are you sure?")&&this.router.navigate(["../extensions/simple-cms"])}},{key:"countWords",value:function(){var t;this.descriptionWordCount=(null===(t=this.detailForm.getRawValue().description)||void 0===t?void 0:t.length)||0}},{key:"selectFeaturedAsset",value:function(){var t=this;this.modalService.fromComponent(f.o,{size:"xl"}).subscribe((function(e){e&&e.length&&(t.featuredAsset=e[0])}))}}]),e}();M.\u0275fac=function(t){return new(t||M)(C.cc(R.e),C.cc(d.e),C.cc(f.Eb),C.cc(f.v),C.cc(f.Fb),C.cc(d.a))},M.\u0275cmp=C.Wb({type:M,selectors:[["content-block-detail"]],decls:22,vars:8,consts:[["class","btn btn-secondary",3,"click",4,"vdrIfPermissions"],[1,"btn","btn-primary",3,"disabled","click"],[1,"form",3,"formGroup","keydown.enter"],["label","Featured asset","for","featuredAsset"],[1,"card"],[1,"card-img"],[1,"featured-asset"],[3,"src","click",4,"ngIf"],[4,"ngIf"],["class","placeholder",3,"click",4,"ngIf"],[1,"card-block"],["class","card-footer",4,"vdrIfPermissions"],["label","Title","for","title"],["id","title","type","text","formControlName","title",3,"input"],["label","Slug","for","slug"],["id","slug","type","text","formControlName","slug"],["for","description",3,"label"],["id","description","formControlName","description",2,"width","100%",3,"input"],["id","contentBlockRte","formControlName","body","label","Content body"],[1,"btn","btn-secondary",3,"click"],[3,"src","click"],[1,"placeholder",3,"click"],["shape","image","size","128"],[1,"card-footer"],[1,"btn",3,"click"],["shape","attachment"]],template:function(t,e){1&t&&(C.ic(0,"vdr-ab-right"),C.Uc(1,P,2,0,"button",0),C.ic(2,"button",1),C.pc("click",(function(){return e.save()})),C.Wc(3," Save "),C.hc(),C.hc(),C.ic(4,"form",2),C.pc("keydown.enter",(function(t){return t.preventDefault()})),C.ic(5,"vdr-form-field",3),C.ic(6,"div",4),C.ic(7,"div",5),C.ic(8,"div",6),C.Uc(9,x,2,4,"img",7),C.Uc(10,$,2,1,"p",8),C.Uc(11,j,5,3,"div",9),C.hc(),C.hc(),C.ic(12,"div",10),C.ec(13),C.hc(),C.Uc(14,D,5,3,"div",11),C.hc(),C.hc(),C.ic(15,"vdr-form-field",12),C.ic(16,"input",13),C.pc("input",(function(t){return e.updateSlug(t.target.value)})),C.hc(),C.hc(),C.ic(17,"vdr-form-field",14),C.dc(18,"input",15),C.hc(),C.ic(19,"vdr-form-field",16),C.ic(20,"textarea",17),C.pc("input",(function(){return e.countWords()})),C.hc(),C.hc(),C.dc(21,"vdr-rich-text-editor",18),C.hc()),2&t&&(C.Rb(1),C.yc("vdrIfPermissions","UpdateCatalog"),C.Rb(1),C.yc("disabled",e.detailForm.invalid||e.detailForm.pristine),C.Rb(2),C.yc("formGroup",e.detailForm),C.Rb(5),C.yc("ngIf",e.featuredAsset),C.Rb(1),C.yc("ngIf",e.featuredAssetUrl&&!e.featuredAsset),C.Rb(1),C.yc("ngIf",!e.featuredAsset),C.Rb(3),C.yc("vdrIfPermissions","UpdateCatalog"),C.Rb(5),C.Ac("label","SEO description (",e.descriptionWordCount,") "))},directives:[f.f,f.sb,R.E,R.q,R.j,f.fb,S.p,f.gb,R.b,R.p,R.h,f.Lb,F.o],pipes:[f.r,O.d],styles:["[_nghost-%COMP%]     #contentBlockRte>div>div>div.ProseMirror.vdr-prosemirror{height:600px;resize:vertical}.placeholder[_ngcontent-%COMP%]{text-align:center;color:var(--color-grey-300)}.featured-asset[_ngcontent-%COMP%]{text-align:center;background:var(--color-component-bg-200);padding:6px;cursor:pointer}.featured-asset.compact[_ngcontent-%COMP%]{width:100%;min-height:40px;position:relative;padding:6px}.featured-asset[_ngcontent-%COMP%]   .compact-select[_ngcontent-%COMP%]{position:absolute;bottom:6px;right:6px;margin:0}"]});var W=function e(){t(this,e)};W.\u0275mod=C.ac({type:W}),W.\u0275inj=C.Zb({factory:function(t){return new(t||W)},imports:[[f.Ob,d.i.forChild([{path:"",pathMatch:"full",component:A,data:{breadcrumb:"Content"}},{path:"create",pathMatch:"full",component:M,data:{breadcrumb:"Content"}},{path:":id",pathMatch:"full",component:M,data:{breadcrumb:"Content"}}])]]})}}])}();
//# sourceMappingURL=9-es5.6685fb2559ad7c5aab56.js.map