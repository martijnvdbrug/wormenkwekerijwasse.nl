(window.webpackJsonp=window.webpackJsonp||[]).push([[7],{"8aHv":function(e,t,r){"use strict";r.r(t),r.d(t,"ReviewsUiLazyModule",(function(){return de})),r.d(t,"productReviewsBreadcrumb",(function(){return le})),r.d(t,"reviewDetailBreadcrumb",(function(){return ue}));var i,c,n,a,o,s,d,l,u,m,p,R,h,g=r("sEIs"),f=r("YtkY"),b=r("ixhn");!function(e){e.Pending="PENDING",e.Running="RUNNING",e.Completed="COMPLETED",e.Retrying="RETRYING",e.Failed="FAILED"}(i||(i={})),function(e){e.True="TRUE",e.False="FALSE",e.Inherit="INHERIT"}(c||(c={})),function(e){e.Tax="TAX",e.Promotion="PROMOTION",e.Shipping="SHIPPING",e.Refund="REFUND",e.TaxRefund="TAX_REFUND",e.PromotionRefund="PROMOTION_REFUND",e.ShippingRefund="SHIPPING_REFUND"}(n||(n={})),function(e){e.Deleted="DELETED",e.NotDeleted="NOT_DELETED"}(a||(a={})),function(e){e.Authenticated="Authenticated",e.SuperAdmin="SuperAdmin",e.Owner="Owner",e.Public="Public",e.CreateCatalog="CreateCatalog",e.ReadCatalog="ReadCatalog",e.UpdateCatalog="UpdateCatalog",e.DeleteCatalog="DeleteCatalog",e.CreateCustomer="CreateCustomer",e.ReadCustomer="ReadCustomer",e.UpdateCustomer="UpdateCustomer",e.DeleteCustomer="DeleteCustomer",e.CreateAdministrator="CreateAdministrator",e.ReadAdministrator="ReadAdministrator",e.UpdateAdministrator="UpdateAdministrator",e.DeleteAdministrator="DeleteAdministrator",e.CreateOrder="CreateOrder",e.ReadOrder="ReadOrder",e.UpdateOrder="UpdateOrder",e.DeleteOrder="DeleteOrder",e.CreatePromotion="CreatePromotion",e.ReadPromotion="ReadPromotion",e.UpdatePromotion="UpdatePromotion",e.DeletePromotion="DeletePromotion",e.CreateSettings="CreateSettings",e.ReadSettings="ReadSettings",e.UpdateSettings="UpdateSettings",e.DeleteSettings="DeleteSettings"}(o||(o={})),function(e){e.Asc="ASC",e.Desc="DESC"}(s||(s={})),function(e){e.UnknownError="UNKNOWN_ERROR",e.MimeTypeError="MIME_TYPE_ERROR",e.LanguageNotAvailableError="LANGUAGE_NOT_AVAILABLE_ERROR",e.ChannelDefaultLanguageError="CHANNEL_DEFAULT_LANGUAGE_ERROR",e.SettlePaymentError="SETTLE_PAYMENT_ERROR",e.EmptyOrderLineSelectionError="EMPTY_ORDER_LINE_SELECTION_ERROR",e.ItemsAlreadyFulfilledError="ITEMS_ALREADY_FULFILLED_ERROR",e.InsufficientStockOnHandError="INSUFFICIENT_STOCK_ON_HAND_ERROR",e.MultipleOrderError="MULTIPLE_ORDER_ERROR",e.CancelActiveOrderError="CANCEL_ACTIVE_ORDER_ERROR",e.PaymentOrderMismatchError="PAYMENT_ORDER_MISMATCH_ERROR",e.RefundOrderStateError="REFUND_ORDER_STATE_ERROR",e.NothingToRefundError="NOTHING_TO_REFUND_ERROR",e.AlreadyRefundedError="ALREADY_REFUNDED_ERROR",e.QuantityTooGreatError="QUANTITY_TOO_GREAT_ERROR",e.RefundStateTransitionError="REFUND_STATE_TRANSITION_ERROR",e.PaymentStateTransitionError="PAYMENT_STATE_TRANSITION_ERROR",e.FulfillmentStateTransitionError="FULFILLMENT_STATE_TRANSITION_ERROR",e.ProductOptionInUseError="PRODUCT_OPTION_IN_USE_ERROR",e.MissingConditionsError="MISSING_CONDITIONS_ERROR",e.NativeAuthStrategyError="NATIVE_AUTH_STRATEGY_ERROR",e.InvalidCredentialsError="INVALID_CREDENTIALS_ERROR",e.OrderStateTransitionError="ORDER_STATE_TRANSITION_ERROR",e.EmailAddressConflictError="EMAIL_ADDRESS_CONFLICT_ERROR"}(d||(d={})),function(e){e.And="AND",e.Or="OR"}(l||(l={})),function(e){e.Aed="AED",e.Afn="AFN",e.All="ALL",e.Amd="AMD",e.Ang="ANG",e.Aoa="AOA",e.Ars="ARS",e.Aud="AUD",e.Awg="AWG",e.Azn="AZN",e.Bam="BAM",e.Bbd="BBD",e.Bdt="BDT",e.Bgn="BGN",e.Bhd="BHD",e.Bif="BIF",e.Bmd="BMD",e.Bnd="BND",e.Bob="BOB",e.Brl="BRL",e.Bsd="BSD",e.Btn="BTN",e.Bwp="BWP",e.Byn="BYN",e.Bzd="BZD",e.Cad="CAD",e.Cdf="CDF",e.Chf="CHF",e.Clp="CLP",e.Cny="CNY",e.Cop="COP",e.Crc="CRC",e.Cuc="CUC",e.Cup="CUP",e.Cve="CVE",e.Czk="CZK",e.Djf="DJF",e.Dkk="DKK",e.Dop="DOP",e.Dzd="DZD",e.Egp="EGP",e.Ern="ERN",e.Etb="ETB",e.Eur="EUR",e.Fjd="FJD",e.Fkp="FKP",e.Gbp="GBP",e.Gel="GEL",e.Ghs="GHS",e.Gip="GIP",e.Gmd="GMD",e.Gnf="GNF",e.Gtq="GTQ",e.Gyd="GYD",e.Hkd="HKD",e.Hnl="HNL",e.Hrk="HRK",e.Htg="HTG",e.Huf="HUF",e.Idr="IDR",e.Ils="ILS",e.Inr="INR",e.Iqd="IQD",e.Irr="IRR",e.Isk="ISK",e.Jmd="JMD",e.Jod="JOD",e.Jpy="JPY",e.Kes="KES",e.Kgs="KGS",e.Khr="KHR",e.Kmf="KMF",e.Kpw="KPW",e.Krw="KRW",e.Kwd="KWD",e.Kyd="KYD",e.Kzt="KZT",e.Lak="LAK",e.Lbp="LBP",e.Lkr="LKR",e.Lrd="LRD",e.Lsl="LSL",e.Lyd="LYD",e.Mad="MAD",e.Mdl="MDL",e.Mga="MGA",e.Mkd="MKD",e.Mmk="MMK",e.Mnt="MNT",e.Mop="MOP",e.Mru="MRU",e.Mur="MUR",e.Mvr="MVR",e.Mwk="MWK",e.Mxn="MXN",e.Myr="MYR",e.Mzn="MZN",e.Nad="NAD",e.Ngn="NGN",e.Nio="NIO",e.Nok="NOK",e.Npr="NPR",e.Nzd="NZD",e.Omr="OMR",e.Pab="PAB",e.Pen="PEN",e.Pgk="PGK",e.Php="PHP",e.Pkr="PKR",e.Pln="PLN",e.Pyg="PYG",e.Qar="QAR",e.Ron="RON",e.Rsd="RSD",e.Rub="RUB",e.Rwf="RWF",e.Sar="SAR",e.Sbd="SBD",e.Scr="SCR",e.Sdg="SDG",e.Sek="SEK",e.Sgd="SGD",e.Shp="SHP",e.Sll="SLL",e.Sos="SOS",e.Srd="SRD",e.Ssp="SSP",e.Stn="STN",e.Svc="SVC",e.Syp="SYP",e.Szl="SZL",e.Thb="THB",e.Tjs="TJS",e.Tmt="TMT",e.Tnd="TND",e.Top="TOP",e.Try="TRY",e.Ttd="TTD",e.Twd="TWD",e.Tzs="TZS",e.Uah="UAH",e.Ugx="UGX",e.Usd="USD",e.Uyu="UYU",e.Uzs="UZS",e.Ves="VES",e.Vnd="VND",e.Vuv="VUV",e.Wst="WST",e.Xaf="XAF",e.Xcd="XCD",e.Xof="XOF",e.Xpf="XPF",e.Yer="YER",e.Zar="ZAR",e.Zmw="ZMW",e.Zwl="ZWL"}(u||(u={})),function(e){e.Af="af",e.Ak="ak",e.Sq="sq",e.Am="am",e.Ar="ar",e.Hy="hy",e.As="as",e.Az="az",e.Bm="bm",e.Bn="bn",e.Eu="eu",e.Be="be",e.Bs="bs",e.Br="br",e.Bg="bg",e.My="my",e.Ca="ca",e.Ce="ce",e.Zh="zh",e.ZhHans="zh_Hans",e.ZhHant="zh_Hant",e.Cu="cu",e.Kw="kw",e.Co="co",e.Hr="hr",e.Cs="cs",e.Da="da",e.Nl="nl",e.NlBe="nl_BE",e.Dz="dz",e.En="en",e.EnAu="en_AU",e.EnCa="en_CA",e.EnGb="en_GB",e.EnUs="en_US",e.Eo="eo",e.Et="et",e.Ee="ee",e.Fo="fo",e.Fi="fi",e.Fr="fr",e.FrCa="fr_CA",e.FrCh="fr_CH",e.Ff="ff",e.Gl="gl",e.Lg="lg",e.Ka="ka",e.De="de",e.DeAt="de_AT",e.DeCh="de_CH",e.El="el",e.Gu="gu",e.Ht="ht",e.Ha="ha",e.He="he",e.Hi="hi",e.Hu="hu",e.Is="is",e.Ig="ig",e.Id="id",e.Ia="ia",e.Ga="ga",e.It="it",e.Ja="ja",e.Jv="jv",e.Kl="kl",e.Kn="kn",e.Ks="ks",e.Kk="kk",e.Km="km",e.Ki="ki",e.Rw="rw",e.Ko="ko",e.Ku="ku",e.Ky="ky",e.Lo="lo",e.La="la",e.Lv="lv",e.Ln="ln",e.Lt="lt",e.Lu="lu",e.Lb="lb",e.Mk="mk",e.Mg="mg",e.Ms="ms",e.Ml="ml",e.Mt="mt",e.Gv="gv",e.Mi="mi",e.Mr="mr",e.Mn="mn",e.Ne="ne",e.Nd="nd",e.Se="se",e.Nb="nb",e.Nn="nn",e.Ny="ny",e.Or="or",e.Om="om",e.Os="os",e.Ps="ps",e.Fa="fa",e.FaAf="fa_AF",e.Pl="pl",e.Pt="pt",e.PtBr="pt_BR",e.PtPt="pt_PT",e.Pa="pa",e.Qu="qu",e.Ro="ro",e.RoMd="ro_MD",e.Rm="rm",e.Rn="rn",e.Ru="ru",e.Sm="sm",e.Sg="sg",e.Sa="sa",e.Gd="gd",e.Sr="sr",e.Sn="sn",e.Ii="ii",e.Sd="sd",e.Si="si",e.Sk="sk",e.Sl="sl",e.So="so",e.St="st",e.Es="es",e.EsEs="es_ES",e.EsMx="es_MX",e.Su="su",e.Sw="sw",e.SwCd="sw_CD",e.Sv="sv",e.Tg="tg",e.Ta="ta",e.Tt="tt",e.Te="te",e.Th="th",e.Bo="bo",e.Ti="ti",e.To="to",e.Tr="tr",e.Tk="tk",e.Uk="uk",e.Ur="ur",e.Ug="ug",e.Uz="uz",e.Vi="vi",e.Vo="vo",e.Cy="cy",e.Fy="fy",e.Wo="wo",e.Xh="xh",e.Yi="yi",e.Yo="yo",e.Zu="zu"}(m||(m={})),function(e){e.Image="IMAGE",e.Video="VIDEO",e.Binary="BINARY"}(p||(p={})),function(e){e.CustomerRegistered="CUSTOMER_REGISTERED",e.CustomerVerified="CUSTOMER_VERIFIED",e.CustomerDetailUpdated="CUSTOMER_DETAIL_UPDATED",e.CustomerAddedToGroup="CUSTOMER_ADDED_TO_GROUP",e.CustomerRemovedFromGroup="CUSTOMER_REMOVED_FROM_GROUP",e.CustomerAddressCreated="CUSTOMER_ADDRESS_CREATED",e.CustomerAddressUpdated="CUSTOMER_ADDRESS_UPDATED",e.CustomerAddressDeleted="CUSTOMER_ADDRESS_DELETED",e.CustomerPasswordUpdated="CUSTOMER_PASSWORD_UPDATED",e.CustomerPasswordResetRequested="CUSTOMER_PASSWORD_RESET_REQUESTED",e.CustomerPasswordResetVerified="CUSTOMER_PASSWORD_RESET_VERIFIED",e.CustomerEmailUpdateRequested="CUSTOMER_EMAIL_UPDATE_REQUESTED",e.CustomerEmailUpdateVerified="CUSTOMER_EMAIL_UPDATE_VERIFIED",e.CustomerNote="CUSTOMER_NOTE",e.OrderStateTransition="ORDER_STATE_TRANSITION",e.OrderPaymentTransition="ORDER_PAYMENT_TRANSITION",e.OrderFulfillment="ORDER_FULFILLMENT",e.OrderCancellation="ORDER_CANCELLATION",e.OrderRefundTransition="ORDER_REFUND_TRANSITION",e.OrderFulfillmentTransition="ORDER_FULFILLMENT_TRANSITION",e.OrderNote="ORDER_NOTE",e.OrderCouponApplied="ORDER_COUPON_APPLIED",e.OrderCouponRemoved="ORDER_COUPON_REMOVED"}(R||(R={})),function(e){e.Adjustment="ADJUSTMENT",e.Allocation="ALLOCATION",e.Release="RELEASE",e.Sale="SALE",e.Cancellation="CANCELLATION",e.Return="RETURN"}(h||(h={}));var E=r("Rc+p"),v=r("EM62"),S=r("nIj0"),C=r("Kej3"),O=r("XLqY"),y=r("oD8X"),D=r("2kYt"),A=r("s2Ay");const T=function(e){return["/extensions","product-reviews",e]};function P(e,t){if(1&e&&(v.ic(0,"td",7),v.Wc(1),v.sc(2,"date"),v.hc(),v.ic(3,"td",7),v.Wc(4),v.hc(),v.ic(5,"td",7),v.ic(6,"div",8),v.dc(7,"img",9),v.ic(8,"span",10),v.Wc(9),v.hc(),v.hc(),v.hc(),v.ic(10,"td",7),v.dc(11,"kb-star-rating",11),v.hc(),v.ic(12,"td",7),v.Wc(13),v.hc(),v.ic(14,"td",7),v.dc(15,"kb-review-state-label",12),v.hc(),v.ic(16,"td",13),v.dc(17,"vdr-table-row-action",14),v.sc(18,"translate"),v.hc()),2&e){const e=t.item;v.Rb(1),v.Yc(" ",v.uc(2,9,e.createdAt,"mediumDate")," "),v.Rb(3),v.Xc(e.authorName),v.Rb(3),v.yc("src",(null==e.product.featuredAsset?null:e.product.featuredAsset.preview)+"?preset=tiny",v.Nc),v.Rb(2),v.Xc(e.product.name),v.Rb(2),v.yc("rating",e.rating),v.Rb(2),v.Xc(e.summary),v.Rb(2),v.yc("state",e.state),v.Rb(2),v.yc("label",v.tc(18,12,"common.edit"))("linkTo",v.Cc(14,T,e.id))}}class N extends b.y{constructor(e,t,r){super(t,r),this.dataService=e,this.filteredState="new",super.setQueryFn((...e)=>this.dataService.query(E.a,e),e=>e.productReviews,(e,t)=>({productId:r.snapshot.paramMap.get("id"),options:Object.assign({skip:e,take:t,sort:{createdAt:s.Desc}},null!=this.filteredState?{filter:{state:{eq:this.filteredState}}}:{})}))}}N.\u0275fac=function(e){return new(e||N)(v.cc(b.M),v.cc(g.e),v.cc(g.a))},N.\u0275cmp=v.Wb({type:N,selectors:[["kb-all-product-reviews-list"]],features:[v.Ob],decls:32,vars:14,consts:[[1,"filter-controls"],["clrSelect","","name","state",3,"ngModel","ngModelChange","change"],[3,"ngValue"],["value","new"],["value","approved"],["value","rejected"],[3,"items","itemsPerPage","totalItems","currentPage","pageChange","itemsPerPageChange"],[1,"left","align-middle"],[1,"product-info"],["width","50","height","50",3,"src"],[1,"product-name"],[3,"rating"],[3,"state"],[1,"right","align-middle"],["iconShape","edit",3,"label","linkTo"]],template:function(e,t){1&e&&(v.ic(0,"vdr-action-bar"),v.ic(1,"vdr-ab-left"),v.ic(2,"div",0),v.ic(3,"select",1),v.pc("ngModelChange",(function(e){return t.filteredState=e}))("change",(function(){return t.refresh()})),v.ic(4,"option",2),v.Wc(5,"All reviews"),v.hc(),v.ic(6,"option",3),v.Wc(7,"Reviews pending approval"),v.hc(),v.ic(8,"option",4),v.Wc(9,"Approved reviews"),v.hc(),v.ic(10,"option",5),v.Wc(11,"Rejected reviews"),v.hc(),v.hc(),v.hc(),v.hc(),v.dc(12,"vdr-ab-right"),v.hc(),v.ic(13,"vdr-data-table",6),v.pc("pageChange",(function(e){return t.setPageNumber(e)}))("itemsPerPageChange",(function(e){return t.setItemsPerPage(e)})),v.sc(14,"async"),v.sc(15,"async"),v.sc(16,"async"),v.sc(17,"async"),v.ic(18,"vdr-dt-column"),v.Wc(19,"Submitted"),v.hc(),v.ic(20,"vdr-dt-column"),v.Wc(21,"Author"),v.hc(),v.ic(22,"vdr-dt-column"),v.Wc(23,"Product"),v.hc(),v.ic(24,"vdr-dt-column"),v.Wc(25,"Rating"),v.hc(),v.ic(26,"vdr-dt-column"),v.Wc(27,"Summary"),v.hc(),v.ic(28,"vdr-dt-column"),v.Wc(29,"Status"),v.hc(),v.dc(30,"vdr-dt-column"),v.Uc(31,P,19,16,"ng-template"),v.hc()),2&e&&(v.Rb(3),v.yc("ngModel",t.filteredState),v.Rb(1),v.yc("ngValue",null),v.Rb(9),v.yc("items",v.tc(14,6,t.items$))("itemsPerPage",v.tc(15,8,t.itemsPerPage$))("totalItems",v.tc(16,10,t.totalItems$))("currentPage",v.tc(17,12,t.currentPage$)))},directives:[b.c,b.e,b.gb,S.A,C.A,S.p,S.s,S.u,S.D,b.f,b.O,b.N,O.a,y.a,b.Tb],pipes:[D.b,D.f,A.d],styles:[".filter-controls[_ngcontent-%COMP%]{margin-bottom:12px}.product-info[_ngcontent-%COMP%]{display:flex;align-items:center}.product-name[_ngcontent-%COMP%]{white-space:nowrap;overflow:hidden;text-overflow:ellipsis;max-width:20vw;margin-left:6px}"],changeDetection:0});var _=r("ROBh"),I=r("TLy2"),w=r("xVbo"),M=r("7SLS"),U=r("H5qd"),k=r.n(U),L=r("11En");const F=k.a`
    mutation UpdateReview($input: UpdateProductReviewInput!) {
        updateProductReview(input: $input) {
            ...ProductReview
        }
    }
    ${L.a}
`,B=k.a`
    mutation ApproveReview($id: ID!) {
        approveProductReview(id: $id) {
            id
            state
            product {
                id
                customFields {
                    reviewCount
                    reviewRating
                }
            }
        }
    }
`,G=k.a`
    mutation RejectReview($id: ID!) {
        rejectProductReview(id: $id) {
            id
            state
        }
    }
`;function x(e,t){if(1&e){const e=v.jc();v.ic(0,"button",25),v.pc("click",(function(){v.Lc(e);return v.rc(2).approve()})),v.dc(1,"clr-icon",26),v.Wc(2," Approve "),v.hc()}if(2&e){const e=v.rc(2);v.yc("disabled",e.detailForm.invalid)}}function K(e,t){if(1&e){const e=v.jc();v.ic(0,"button",27),v.pc("click",(function(){v.Lc(e);return v.rc(2).reject()})),v.dc(1,"clr-icon",28),v.Wc(2," Reject "),v.hc()}if(2&e){const e=v.rc(2);v.yc("disabled",e.detailForm.invalid)}}function W(e,t){1&e&&(v.gc(0),v.Uc(1,x,3,1,"button",23),v.Uc(2,K,3,1,"button",24),v.fc()),2&e&&(v.Rb(1),v.yc("vdrIfPermissions","UpdateCatalog"),v.Rb(1),v.yc("vdrIfPermissions","UpdateCatalog"))}function H(e,t){if(1&e){const e=v.jc();v.ic(0,"button",30),v.pc("click",(function(){v.Lc(e);return v.rc(2).save()})),v.Wc(1),v.sc(2,"translate"),v.hc()}if(2&e){const e=v.rc(2);v.yc("disabled",e.detailForm.invalid||e.detailForm.pristine),v.Rb(1),v.Yc(" ",v.tc(2,2,"common.update")," ")}}function $(e,t){1&e&&v.Uc(0,H,3,4,"button",29),2&e&&v.yc("vdrIfPermissions","UpdateCatalog")}const j=function(e){return["/catalog","products",e]};function Y(e,t){if(1&e&&(v.ic(0,"div",31),v.ic(1,"div",32),v.dc(2,"img",33),v.hc(),v.ic(3,"div",34),v.ic(4,"a",35),v.Wc(5),v.hc(),v.hc(),v.hc()),2&e){const e=t.ngIf;v.Rb(2),v.yc("src",e.product.featuredAsset.preview+"?preset=small",v.Nc),v.Rb(2),v.yc("routerLink",v.Cc(3,j,e.product.id)),v.Rb(1),v.Xc(e.product.name)}}class q extends b.w{constructor(e,t,r,i,c,n,a){super(e,t,r,c),this.formBuilder=i,this.dataService=c,this.changeDetector=n,this.notificationService=a,this.detailForm=this.formBuilder.group({summary:["",S.C.required],body:"",rating:[0,S.C.required],authorName:["",S.C.required],authorLocation:"",state:"",response:""})}ngOnInit(){this.init(),this.reviewState$=this.entity$.pipe(Object(f.a)(e=>e.state))}approve(){this.saveChanges().pipe(Object(I.a)(()=>this.dataService.mutate(B,{id:this.id}))).subscribe(()=>{this.detailForm.markAsPristine(),this.changeDetector.markForCheck(),this.notificationService.success("Review was approved")},()=>{this.notificationService.error("An error occurred when attempting to approve the review")})}reject(){this.saveChanges().pipe(Object(I.a)(()=>this.dataService.mutate(G,{id:this.id}))).subscribe(()=>{this.detailForm.markAsPristine(),this.changeDetector.markForCheck(),this.notificationService.success("Review was rejected")},()=>{this.notificationService.error("An error occurred when attempting to reject the review")})}save(){this.saveChanges().pipe(Object(w.a)(e=>!!e)).subscribe(()=>{this.detailForm.markAsPristine(),this.changeDetector.markForCheck(),this.notificationService.success("common.notify-update-success",{entity:"ProductReview"})},()=>{this.notificationService.error("common.notify-update-error",{entity:"ProductReview"})})}saveChanges(){if(this.detailForm.dirty){const e=this.detailForm.value,t={id:this.id,summary:e.summary,body:e.body,response:e.response};return this.dataService.mutate(F,{input:t}).pipe(Object(M.a)(!0))}return Object(_.a)(!1)}setFormValues(e){this.detailForm.patchValue({summary:e.summary,body:e.body,rating:e.rating,authorName:e.authorName,authorLocation:e.authorLocation,state:e.state,response:e.response})}}q.\u0275fac=function(e){return new(e||q)(v.cc(g.a),v.cc(g.e),v.cc(b.Nb),v.cc(S.e),v.cc(b.M),v.cc(v.k),v.cc(b.Fb))},q.\u0275cmp=v.Wb({type:q,selectors:[["kb-product-review-detail"]],features:[v.Ob],decls:36,vars:30,consts:[[1,"review-info"],[3,"entity"],[3,"state"],[4,"ngIf","ngIfElse"],["updateButton",""],[1,"clr-row"],[1,"clr-col"],[1,"form",3,"formGroup"],[1,"form-block"],["label","Summary","for","summary"],["id","summary","type","text","formControlName","summary",3,"readonly"],["label","Rating","for","rating"],[3,"rating"],["label","Body","for","body"],["clrTextarea","","id","body","formControlName","body",3,"readonly"],["label","Author name","for","authorName"],["id","authorName","type","text","formControlName","authorName",3,"readonly"],["label","Author location","for","authorLocation"],["id","authorLocation","type","text","formControlName","authorLocation",3,"readonly"],["label","Response","for","response"],["clrTextarea","","id","response","formControlName","response",3,"readonly"],[1,"clr-col-4"],["class","card",4,"ngIf"],["class","btn btn-success",3,"disabled","click",4,"vdrIfPermissions"],["class","btn btn-warning",3,"disabled","click",4,"vdrIfPermissions"],[1,"btn","btn-success",3,"disabled","click"],["shape","check"],[1,"btn","btn-warning",3,"disabled","click"],["shape","times"],["class","btn btn-primary",3,"disabled","click",4,"vdrIfPermissions"],[1,"btn","btn-primary",3,"disabled","click"],[1,"card"],[1,"card-img"],[1,"product-image",3,"src"],[1,"card-footer"],[3,"routerLink"]],template:function(e,t){if(1&e&&(v.ic(0,"vdr-action-bar"),v.ic(1,"vdr-ab-left"),v.ic(2,"div",0),v.dc(3,"vdr-entity-info",1),v.sc(4,"async"),v.dc(5,"kb-review-state-label",2),v.sc(6,"async"),v.hc(),v.hc(),v.ic(7,"vdr-ab-right"),v.Uc(8,W,3,2,"ng-container",3),v.sc(9,"async"),v.Uc(10,$,1,1,"ng-template",null,4,v.Vc),v.hc(),v.hc(),v.ic(12,"div",5),v.ic(13,"div",6),v.ic(14,"form",7),v.ic(15,"section",8),v.ic(16,"vdr-form-field",9),v.dc(17,"input",10),v.sc(18,"hasPermission"),v.hc(),v.ic(19,"vdr-form-field",11),v.dc(20,"kb-star-rating",12),v.hc(),v.ic(21,"vdr-form-field",13),v.dc(22,"textarea",14),v.sc(23,"hasPermission"),v.hc(),v.ic(24,"vdr-form-field",15),v.dc(25,"input",16),v.sc(26,"hasPermission"),v.hc(),v.ic(27,"vdr-form-field",17),v.dc(28,"input",18),v.sc(29,"hasPermission"),v.hc(),v.ic(30,"vdr-form-field",19),v.dc(31,"textarea",20),v.sc(32,"hasPermission"),v.hc(),v.hc(),v.hc(),v.hc(),v.ic(33,"div",21),v.Uc(34,Y,6,5,"div",22),v.sc(35,"async"),v.hc(),v.hc()),2&e){const e=v.Ic(11);var r;v.Rb(3),v.yc("entity",v.tc(4,12,t.entity$)),v.Rb(2),v.yc("state",v.tc(6,14,t.reviewState$)),v.Rb(3),v.yc("ngIf","new"===v.tc(9,16,t.reviewState$))("ngIfElse",e),v.Rb(6),v.yc("formGroup",t.detailForm),v.Rb(3),v.yc("readonly",!v.tc(18,18,"UpdateCatalog")),v.Rb(3),v.yc("rating",null==(r=t.detailForm.get("rating"))?null:r.value),v.Rb(2),v.yc("readonly",!v.tc(23,20,"UpdateCatalog")),v.Rb(3),v.yc("readonly",!v.tc(26,22,"UpdateCatalog")),v.Rb(3),v.yc("readonly",!v.tc(29,24,"UpdateCatalog")),v.Rb(3),v.yc("readonly",!v.tc(32,26,"UpdateCatalog")),v.Rb(3),v.yc("ngIf",v.tc(35,28,t.entity$))}},directives:[b.c,b.e,b.cb,y.a,b.f,D.p,S.E,S.q,S.j,b.fb,b.gb,S.b,S.p,S.h,O.a,C.H,b.sb,C.o,g.h],pipes:[D.b,b.kb,A.d],styles:[".review-info[_ngcontent-%COMP%]{display:flex;align-items:center}.rating-input[_ngcontent-%COMP%]{max-width:64px;margin-right:6px}  .clr-form-control{flex:1}  .clr-form-control .clr-control-container{width:100%}  .clr-form-control textarea{width:100%;height:250px}.product-image[_ngcontent-%COMP%]{max-width:300px;margin:auto}"]});var V=r("wqq/");const z=k.a`
    query GetReviewForProduct($productId: ID!, $options: ProductReviewListOptions) {
        product(id: $productId) {
            id
            reviews(options: $options) {
                items {
                    ...ProductReview
                }
                totalItems
            }
        }
    }
    ${L.a}
`,X=k.a`
    query GetReviewsHistogram($id: ID!) {
        product(id: $id) {
            id
            name
            featuredAsset {
                id
                preview
            }
            customFields {
                reviewRating
                reviewCount
            }
            reviewsHistogram {
                bin
                frequency
            }
        }
    }
`;function Z(e,t){if(1&e){const e=v.jc();v.ic(0,"div",1),v.dc(1,"kb-star-rating",2),v.ic(2,"div",3),v.dc(3,"div",4),v.hc(),v.ic(4,"div",5),v.Wc(5),v.hc(),v.ic(6,"button",6),v.pc("click",(function(){v.Lc(e);const r=t.$implicit;return v.rc().toggleBinFilter(r)})),v.dc(7,"clr-icon",7),v.hc(),v.hc()}if(2&e){const e=t.$implicit,r=v.rc();v.Rb(1),v.yc("rating",e)("showLabel",!1),v.Rb(2),v.Rc("width",r.getPercentage(e),"%"),v.Rb(2),v.Yc(" ",r.getFrequency(e)," "),v.Rb(1),v.Ub("active",r.filteredBin===e),v.yc("disabled",0===r.getFrequency(e))}}class J{constructor(){this.binData=[],this.filterChange=new v.u,this.bins=[5,4,3,2,1],this.filteredBin=null}ngOnChanges(){this.max=this.binData?Math.max(...this.binData.map(e=>e.frequency)):0}getPercentage(e){if(!this.binData)return 0;const t=this.binData.find(t=>t.bin===e);return t?Math.round(t.frequency/this.max*100):0}getFrequency(e){if(!this.binData)return 0;const t=this.binData.find(t=>t.bin===e);return t?t.frequency:0}toggleBinFilter(e){this.filteredBin===e?this.filteredBin=null:this.filteredBin=e,this.filterChange.emit(this.filteredBin)}}function Q(e,t){if(1&e&&(v.ic(0,"div",4),v.dc(1,"img",5),v.dc(2,"kb-star-rating",6),v.hc()),2&e){const e=t.ngIf;v.Rb(1),v.yc("src",(null==e.featuredAsset?null:e.featuredAsset.preview)+"?preset=tiny",v.Nc),v.Rb(1),v.yc("rating",e.customFields.reviewRating)}}J.\u0275fac=function(e){return new(e||J)},J.\u0275cmp=v.Wb({type:J,selectors:[["kb-review-histogram"]],inputs:{binData:"binData"},outputs:{filterChange:"filterChange"},features:[v.Pb],decls:1,vars:1,consts:[["class","bar-container",4,"ngFor","ngForOf"],[1,"bar-container"],[3,"rating","showLabel"],[1,"bar"],[1,"fill"],[1,"frequency"],["title","Filter reviews with this rating",1,"icon-button","filter-button",3,"disabled","click"],["shape","filter-2"]],template:function(e,t){1&e&&v.Uc(0,Z,8,8,"div",0),2&e&&v.yc("ngForOf",t.bins)},directives:[D.o,O.a,C.o],styles:["[_nghost-%COMP%]{display:block;margin-bottom:6px}.bar-container[_ngcontent-%COMP%]{display:flex;align-items:center}.bar[_ngcontent-%COMP%]{background-color:#f2f3f5;width:100px;margin:0 6px}.fill[_ngcontent-%COMP%]{background-color:#cab526;text-align:right;height:12px}.frequency[_ngcontent-%COMP%]{color:#3f4445;font-size:12px;min-width:16px;line-height:12px}.filter-button[_ngcontent-%COMP%]{margin-left:6px;border-radius:3px;line-height:16px}.filter-button[disabled][_ngcontent-%COMP%]{opacity:.5;cursor:default}.filter-button.active[_ngcontent-%COMP%]{background-color:#13b7f3;color:#fff}"],changeDetection:0});const ee=function(e){return["/extensions","product-reviews",e]};function te(e,t){if(1&e&&(v.ic(0,"td",7),v.Wc(1),v.sc(2,"date"),v.hc(),v.ic(3,"td",7),v.Wc(4),v.hc(),v.ic(5,"td",7),v.dc(6,"kb-star-rating",6),v.hc(),v.ic(7,"td",7),v.Wc(8),v.hc(),v.ic(9,"td",7),v.dc(10,"kb-review-state-label",8),v.hc(),v.ic(11,"td",9),v.dc(12,"vdr-table-row-action",10),v.sc(13,"translate"),v.hc()),2&e){const e=t.item;v.Rb(1),v.Yc(" ",v.uc(2,7,e.createdAt,"mediumDate")," "),v.Rb(3),v.Xc(e.authorName),v.Rb(2),v.yc("rating",e.rating),v.Rb(2),v.Xc(e.summary),v.Rb(2),v.yc("state",e.state),v.Rb(2),v.yc("label",v.tc(13,10,"common.edit"))("linkTo",v.Cc(12,ee,e.id))}}class re extends b.y{constructor(e,t,r){super(t,r),this.dataService=e,super.setQueryFn((...e)=>this.dataService.query(z,e),e=>e.product.reviews,(e,t)=>({productId:r.snapshot.paramMap.get("id"),options:Object.assign({skip:e,take:t,sort:{createdAt:s.Desc}},null!=this.filteredRating?{filter:{rating:{eq:this.filteredRating}}}:{})}))}ngOnInit(){super.ngOnInit();const e=this.dataService.query(X,{id:this.route.snapshot.paramMap.get("id")||""}).single$.pipe(Object(V.a)(1));this.histogramBinData$=e.pipe(Object(f.a)(e=>e.product?e.product.reviewsHistogram:[])),this.product$=e.pipe(Object(f.a)(e=>e.product))}applyRatingFilters(e){this.filteredRating=e,this.refresh()}}re.\u0275fac=function(e){return new(e||re)(v.cc(b.M),v.cc(g.e),v.cc(g.a))},re.\u0275cmp=v.Wb({type:re,selectors:[["kb-product-reviews-list"]],features:[v.Ob],decls:25,vars:18,consts:[[1,"summary"],["class","image-preview",4,"ngIf"],[3,"binData","filterChange"],[3,"items","itemsPerPage","totalItems","currentPage","pageChange","itemsPerPageChange"],[1,"image-preview"],[3,"src"],[3,"rating"],[1,"left","align-middle"],[3,"state"],[1,"right","align-middle"],["iconShape","edit",3,"label","linkTo"]],template:function(e,t){1&e&&(v.ic(0,"vdr-action-bar"),v.ic(1,"vdr-ab-left"),v.ic(2,"div",0),v.Uc(3,Q,3,2,"div",1),v.sc(4,"async"),v.ic(5,"kb-review-histogram",2),v.pc("filterChange",(function(e){return t.applyRatingFilters(e)})),v.sc(6,"async"),v.hc(),v.hc(),v.hc(),v.dc(7,"vdr-ab-right"),v.hc(),v.ic(8,"vdr-data-table",3),v.pc("pageChange",(function(e){return t.setPageNumber(e)}))("itemsPerPageChange",(function(e){return t.setItemsPerPage(e)})),v.sc(9,"async"),v.sc(10,"async"),v.sc(11,"async"),v.sc(12,"async"),v.ic(13,"vdr-dt-column"),v.Wc(14,"Submitted"),v.hc(),v.ic(15,"vdr-dt-column"),v.Wc(16,"Author"),v.hc(),v.ic(17,"vdr-dt-column"),v.Wc(18,"Rating"),v.hc(),v.ic(19,"vdr-dt-column"),v.Wc(20,"Summary"),v.hc(),v.ic(21,"vdr-dt-column"),v.Wc(22,"Status"),v.hc(),v.dc(23,"vdr-dt-column"),v.Uc(24,te,14,14,"ng-template"),v.hc()),2&e&&(v.Rb(3),v.yc("ngIf",v.tc(4,6,t.product$)),v.Rb(2),v.yc("binData",v.tc(6,8,t.histogramBinData$)),v.Rb(3),v.yc("items",v.tc(9,10,t.items$))("itemsPerPage",v.tc(10,12,t.itemsPerPage$))("totalItems",v.tc(11,14,t.totalItems$))("currentPage",v.tc(12,16,t.currentPage$)))},directives:[b.c,b.e,D.p,J,b.f,b.O,b.N,O.a,y.a,b.Tb],pipes:[D.b,D.f,A.d],styles:[".summary[_ngcontent-%COMP%]{display:flex}.image-preview[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;padding:12px;margin-right:6px;background-color:#f2f3f5}"],changeDetection:0});const ie=k.a`
    query GetProductName($id: ID!) {
        product(id: $id) {
            id
            name
        }
    }
`;class ce{constructor(e){this.dataService=e}resolve(e){return this.dataService.query(ie,{id:e.paramMap.get("id")||""}).mapSingle(e=>e.product)}}ce.\u0275fac=function(e){return new(e||ce)(v.mc(b.M))},ce.\u0275prov=v.Yb({token:ce,factory:ce.\u0275fac});var ne=r("J+dc");const ae=k.a`
    query GetReview($id: ID!) {
        productReview(id: $id) {
            ...ProductReview
            product {
                id
                name
                featuredAsset {
                    id
                    preview
                }
            }
            productVariant {
                id
                name
                featuredAsset {
                    id
                    preview
                }
            }
        }
    }
    ${L.a}
`;class oe{constructor(e){this.dataService=e}resolve(e){const t=this.dataService.query(ae,{id:e.paramMap.get("id")||""}).mapStream(e=>e.productReview).pipe(Object(V.a)(1));return t.pipe(Object(ne.a)(1),Object(f.a)(()=>t))}}oe.\u0275fac=function(e){return new(e||oe)(v.mc(b.M))},oe.\u0275prov=v.Yb({token:oe,factory:oe.\u0275fac});var se=r("Tjeh");class de{}function le(e,t){return[{label:"breadcrumb.products",link:["/catalog","products"]},{label:`${e.data.name}`,link:["/catalog","products",t.id]},{label:"Reviews",link:[""]}]}function ue(e){return e.entity.pipe(Object(f.a)(e=>[{label:"Product reviews",link:["/extensions","product-reviews"]},{label:`${e.id}`,link:[]}]))}de.\u0275mod=v.ac({type:de}),de.\u0275inj=v.Zb({factory:function(e){return new(e||de)},providers:[ce,oe],imports:[[se.a,g.i.forChild([{path:"product/:id",component:re,resolve:{data:ce},data:{breadcrumb:le}},{path:"",pathMatch:"full",component:N,data:{breadcrumb:[{label:"Product reviews",link:["/extensions","product-reviews"]}]}},{path:":id",component:q,resolve:{entity:oe},data:{breadcrumb:ue}}])]]})}}]);
//# sourceMappingURL=7-es2015.685fb42646c743128a1e.js.map